# 백트래킹(backtracking)

> 가능성이 있는 후보들 중 조건에 맞는 해를 탐색하는 과정에서, 중간에 조건을 만족하지 않으면 더 이상 진행하지 않고 돌아가는(backtrack)방식

즉, 완전 탐색(브루트포스)과 비슷하지만, **'가지치기(pruning)'을 포함한 탐색**이라고 보면 된다.

## 어떤 문제에서 백트래킹을 떠올려야 할까?

다음 조 건에서 백트래킹을 고려해볼 수 있다.

| 조건                                                             | 설명                                             |
| ---------------------------------------------------------------- | ------------------------------------------------ |
| **조건을 만족하는 모든 경우(또는 최적의 경우)를 찾아야 할 때**   | 예: 모던 경로, 조합, 순열, n-queen, 스도쿠       |
| **결정해야 할 것이 여러 단계로 나뉘어 있을 때**                  | 단계마다 하나씩 선택하여 내려감(트리형태로 생각) |
| **중간 단계에서 잘못된 선택이 전체 결과에 영향을 줄 수 있을 뗴** | 예: 특정 조건 위반 시 더 이상 탐색할 필요 없음   |
| **재귀적으로 분기하면서 조건을 검사할 수 있을 때**               | DFS 구조로 자연스럽게 백트래킹을 구현할 수 있음  |

## 백트래킹 문제 예시 유형

| 유형      | 예시 문제                         | 핵심 아이디어                                |
| --------- | --------------------------------- | -------------------------------------------- |
| 조합      | n개 중 r개 고르기                 | `조합(n, r)` 재귀로 구현, 중복 제거          |
| 순열      | n개의 수로 만들 수 있는 모든 수열 | 방문 여부 체크하며 재귀 호출                 |
| 조건 탐색 | N-Queen, 스도쿠                   | 조건 위반 시 바로 중단(가지치기)             |
| 경로 탐색 | 미로탈출, 달 여행자               | 각 지점에서 선택지 분기, 조건 미달 시 return |

## 백트래킹 문제 파악하는 법

1. **모든 경우를 시도해봐야할까?**  
   → "가능한 모든 경우를 살펴보자"는 느낌이 들면 백트래킹 가능성 ↑
2. **각 선택지마다 다음 선택이 달라지나?**  
   → 순차적인 선택 구조 → 재귀 → 백트래킹
3. **어느 시점에서 탐색을 중단할 수 있는 조건이 있나?**  
   → 가지치기 포인트 → 백트래킹 사용 가능
4. **문제를 트리 구조로 표현할 수 있나?**  
   → 각 단계마다 선택지 분기 → 재귀 DFS → 백트래킹

## 예시로 감잡기

**예: N-Queen 문제**

- 체스판 위에 N개의 퀸을 서로 공격하지 않게 배치
- **각 행에 퀸을 하나씩 배치하되, 이전에 둔 퀸들과 충돌하면 백트랙**

```js
function solveNQueens(n) {
  const result = [];
  const board = Array.from({ length: n }, () => []);

  const isValid = (row, col) => {
    for (let i = 0; i < row; i++) {
      if (
        board[i] === col || // 같은 열
        board[i] - i === col - row || // 대각선1
        board[i] + i === col + row // 대각선2
      )
        return false;
    }
    return true;
  };

  const dfs = (row) => {
    if (row === n) {
      result.push([...board]);
      return;
    }

    for (let col = 0; col < n; col++) {
      if (isValid(row, col)) {
        board[row] = col;
        dfs(row + 1);
        board[row] = undefined; // 백트래킹 (상태 되돌리기)
      }
    }
  };

  dfs(0);
  return result;
}
```

# 요약

- 백트래킹은 **재귀 구조 + 조건 가지치기**
- 핵심은 **"조건 위반 시 더 이상 진행하지 않기"**
- **모든 경우의 수를 탐색하지만, 불필요한 경우는 일찍 배제**한다는 점에서 완전탐색보다 효율적
